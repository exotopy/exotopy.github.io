<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree of Life Study Tool</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }
        .tree-container {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .info-panel {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 80vh;
            overflow-y: auto;
        }
        .sephirah {
            cursor: pointer;
            transition: transform 0.3s;
        }
        .sephirah:hover {
            transform: scale(1.1);
        }
        .path {
            cursor: pointer;
            transition: stroke-width 0.3s;
        }
        .path:hover {
            stroke-width: 4;
        }
        .card-label {
            cursor: pointer;
            transition: font-size 0.3s;
        }
        .card-label:hover {
            font-size: 14px;
            font-weight: bold;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
        }
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
            position: relative;
        }
        .close {
            position: absolute;
            right: 20px;
            top: 10px;
            font-size: 24px;
            cursor: pointer;
        }
        .notes-section textarea {
            width: 100%;
            min-height: 100px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .save-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tree-container">
            <svg viewBox="0 0 600 800" xmlns="http://www.w3.org/2000/svg">
                <!-- Paths -->
                <path class="path" d="M300 100 L200 200" stroke="#666" stroke-width="2"/>
                <path class="path" d="M300 100 L400 200" stroke="#666" stroke-width="2"/>
                <path class="path" d="M200 200 L400 200" stroke="#666" stroke-width="2"/>
                <path class="path" d="M200 200 L300 300" stroke="#666" stroke-width="2"/>
                <path class="path" d="M400 200 L300 300" stroke="#666" stroke-width="2"/>
                <path class="path" d="M200 200 L200 400" stroke="#666" stroke-width="2"/>
                <path class="path" d="M400 200 L400 400" stroke="#666" stroke-width="2"/>
                <path class="path" d="M200 400 L400 400" stroke="#666" stroke-width="2"/>
                <path class="path" d="M200 400 L300 500" stroke="#666" stroke-width="2"/>
                <path class="path" d="M400 400 L300 500" stroke="#666" stroke-width="2"/>
                <path class="path" d="M200 400 L200 600" stroke="#666" stroke-width="2"/>
                <path class="path" d="M400 400 L400 600" stroke="#666" stroke-width="2"/>
                <path class="path" d="M200 600 L400 600" stroke="#666" stroke-width="2"/>
                <path class="path" d="M200 600 L300 700" stroke="#666" stroke-width="2"/>
                <path class="path" d="M400 600 L300 700" stroke="#666" stroke-width="2"/>
                <path class="path" d="M300 100 L300 300" stroke="#666" stroke-width="2"/>
                <path class="path" d="M300 300 L300 500" stroke="#666" stroke-width="2"/>
                <path class="path" d="M300 500 L300 700" stroke="#666" stroke-width="2"/>

                <!-- Sephirot -->
                <circle class="sephirah" cx="300" cy="100" r="30" fill="white" stroke="black" onclick="showInfo('keter', 'Keter - Crown')"/>
                <circle class="sephirah" cx="400" cy="200" r="30" fill="#0000FF" stroke="black" onclick="showInfo('hokmah', 'Hokmah - Wisdom')"/>
                <circle class="sephirah" cx="200" cy="200" r="30" fill="black" stroke="black" onclick="showInfo('binah', 'Binah - Understanding')"/>
                <circle class="sephirah" cx="400" cy="400" r="30" fill="#00BFFF" stroke="black" onclick="showInfo('hesed', 'Hesed - Mercy')"/>
                <circle class="sephirah" cx="200" cy="400" r="30" fill="#FF0000" stroke="black" onclick="showInfo('gevurah', 'Gevurah - Severity')"/>
                <circle class="sephirah" cx="300" cy="500" r="30" fill="#008000" stroke="black" onclick="showInfo('tiferet', 'Tiferet - Beauty')"/>
                <circle class="sephirah" cx="400" cy="600" r="30" fill="#800080" stroke="black" onclick="showInfo('netzah', 'Netzah - Victory')"/>
                <circle class="sephirah" cx="200" cy="600" r="30" fill="#FFA500" stroke="black" onclick="showInfo('hod', 'Hod - Splendor')"/>
                <circle class="sephirah" cx="300" cy="700" r="30" fill="#4B0082" stroke="black" onclick="showInfo('yesod', 'Yesod - Foundation')"/>
                <circle class="sephirah" cx="300" cy="800" r="30" fill="black" stroke="black" onclick="showInfo('malkut', 'Malkut - Kingdom')"/>

                <!-- Labels -->
                <text x="300" y="105" text-anchor="middle" fill="black">Keter</text>
                <text x="400" y="205" text-anchor="middle" fill="white">Hokmah</text>
                <text x="200" y="205" text-anchor="middle" fill="white">Binah</text>
                <text x="400" y="405" text-anchor="middle" fill="black">Hesed</text>
                <text x="200" y="405" text-anchor="middle" fill="white">Gevurah</text>
                <text x="300" y="505" text-anchor="middle" fill="white">Tiferet</text>
                <text x="400" y="605" text-anchor="middle" fill="white">Netzah</text>
                <text x="200" y="605" text-anchor="middle" fill="black">Hod</text>
                <text x="300" y="705" text-anchor="middle" fill="white">Yesod</text>
                <text x="300" y="805" text-anchor="middle" fill="white">Malkut</text>

                <!-- Tarot Card Labels (Example positions - adjust as needed) -->
                <text class="card-label" x="350" y="150" onclick="showInfo('fool', 'The Fool')" text-anchor="middle">0 - The Fool</text>
                <text class="card-label" x="250" y="150" onclick="showInfo('magician', 'The Magician')" text-anchor="middle">I - The Magician</text>
                <!-- Add more card labels for each path -->
            </svg>
        </div>
        
        <div class="info-panel">
            <h2>Tree of Life Study Notes</h2>
            <div id="current-info">
                <p>Click on any Sephirah, path, or Tarot card to view and add notes.</p>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Title</h2>
            <div id="modalContent">
                <div class="notes-section">
                    <h3>Study Notes</h3>
                    <textarea id="notesArea" placeholder="Add your notes here..."></textarea>
                    <button class="save-btn" onclick="saveNotes()">Save Notes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';

        async function showInfo(id, title) {
            const modal = document.getElementById('infoModal');
            const modalTitle = document.getElementById('modalTitle');
            const notesArea = document.getElementById('notesArea');
            
            modalTitle.textContent = title;
            modal.dataset.currentId = id;
            modal.dataset.currentTitle = title;
            
            try {
                const response = await fetch(`${API_URL}/notes/${id}`);
                const note = await response.json();
                notesArea.value = note.content || '';
            } catch (error) {
                console.error('Error fetching notes:', error);
                notesArea.value = '';
            }
            
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('infoModal').style.display = 'none';
        }

        async function saveNotes() {
            const modal = document.getElementById('infoModal');
            const id = modal.dataset.currentId;
            const title = modal.dataset.currentTitle;
            const notesArea = document.getElementById('notesArea');
            
            try {
                const response = await fetch(`${API_URL}/notes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        elementId: id,
                        title: title,
                        content: notesArea.value
                    })
                });
                
                if (response.ok) {
                    alert('Notes saved successfully!');
                } else {
                    throw new Error('Failed to save notes');
                }
            } catch (error) {
                console.error('Error saving notes:', error);
                alert('Failed to save notes. Please try again.');
            }
        }

        window.onclick = function(event) {
            const modal = document.getElementById('infoModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
